<html onclick='wechsel();'><body><button onclick='weiter();'>START RECORDING</button><audio autoplay loop></audio></body>
<style>
html { background-color:red; background-size:5%;}
html:active {background-color:#e4e417;}
button {
	height:min(70vw, 70vh);width:min(70vw, 70vh);position:absolute;top:calc(50% - min(35vw, 35vh));left:calc(50% - min(35vw, 35vh));font-size:min(5vw, 5vh);
	background:#ffffdddd;border-width:0.4em;box-shadow: -0.04em -0.04em 0 0.04em #ffffffbb, inset 0.04em 0.04em 0 0.1em #ffffff77;text-shadow: 0.04em 0.04em 0.04em yellow;
}
button:active {background:white;box-shadow: 0 0 0}
</style>
<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="ia11y3vy18e460h"></script>
<script>
const a = document.getElementsByTagName('audio')[0];
const h = document.getElementsByTagName('html')[0].style;
const t = ['audio/mp4','audio/webm','audio/ogg'];
var re = '';
var sa = 0;
function wechsel() { if (sa==0) { return; } if (a.paused===false) { a.pause(); h.backgroundColor = 'grey'; } else { a.play(); h.backgroundColor = 'white'; } }
function weiter() {
	if (re.state=='inactive' && sa==0) { 
		audioChunks = []; re.start(); a.pause(); document.getElementsByTagName('button')[0].innerHTML = 'STOP RECORDING<br><br>and<br><br>START PLAYING';
		h.backgroundImage = 'url(https://webstockreview.net/images/microphone-clipart-svg-5.png)';
	} else if (re.state=='recording') {
		re.stop(); sa = 1; document.getElementsByTagName('button')[0].innerHTML = 'DOWNLOAD MP3<br><br>AUDIO FILE';
		h.backgroundImage = 'url(https://cdn.iconscout.com/icon/free/png-256/voice-45-470369.png)'; alert('Click the outer surface to pause/play.');
	} else {
		var b = document.createElement('a'); b.href = a.src; b.target = '_blank'; b.download = 'AudioNote.wav';	document.body.appendChild(b);
		b.click(); b.remove(); sa = 0; document.getElementsByTagName('button')[0].innerHTML = 'START RECORDING'; a.pause(); h.backgroundImage = 'none';
		h.backgroundColor = 'grey';
	}
}
navigator.mediaDevices.getUserMedia({audio:true})
.then(stream => {handlerFunction(stream)})
.catch((err) => { alert('error'); alert(err.name); alert(err.message); alert(MediaRecorder.isTypeSupported());});

function handlerFunction(stream) {
	t.forEach(function(v) { if (MediaRecorder.isTypeSupported(v)) { re = new MediaRecorder(stream, {mimeType:v}); } });
	re.ondataavailable = e => {
		audioChunks.push(e.data); // alert(e);
		if (re.state == 'inactive') {
			let blob = new Blob(audioChunks, {type:re.mimeType}); // alert(blob);
			a.src = URL.createObjectURL(blob); // alert(a.src);
		}
	}
}
</script>
</html>